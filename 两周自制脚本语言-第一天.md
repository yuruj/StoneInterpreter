## 两周自制脚本语言-第一天

设计程序时使用的语言称为程序设计语言。如Java语言、C语言、Ruby语言、C++语言、Python语言等，都是程序设计语言

程序员必须使用与各程序设计语言相匹配的软件来执行由该语言写成的程序。这种软件通常称为语言处理器

有些程序设计语言无需借助软件执行，也就是说，他们不需要语言处理器。这些语言称为机器语言。机器余元可以由硬件直接解释执行，理论上不必使用软件

然而，机器语言书写的程序只有载入内存后才能通过硬件执行。因此用户在实际使用时，必须先通过软件从磁盘文件中读取机器语言程序，再将它复制至内存。不过，这类程序称不上是语言处理器，通常称为操作系统Operating System OS

语言处理器可大致分为解释器与编译器两种。这两类语言处理器的执行原理有很大差异

**解释器**

解释器根据程序中的算法执行运算。简单来讲，它是一种用于执行程序的软件。如果执行的程序由虚拟机器语言或类似于机器语言的程序设计语言写成，这种软件也能称为虚拟机

**编译器**

编译器能将某种语言写成的程序转换为另一种语言的程序。通常他会将原程序转换为机器语言程序。编译器转换程序的行为称为编译，转换前的程序称为源代码或源程序。如果编译器没有把源代码直接转换为机器语言，一般称为源代码转换器或源码转换器 source code translator

一些具有解释器，则另一些会提供编译器。尽管C语言也提供了解释器，但却很少使用。Common Lisp或Haskell等语言一般会同时提供解释器与编译器，供用户根据需要选用

有些语言混用解释器与编译器。Java语言首先会通过编译器把源代码转换为Java二进制代码，并将这种虚拟的机器语言保存在文件中。之后，Java虚拟机的解释器将执行这段代码

传统的狭义的编译器将会以文件形式保存转换后的程序。然而，一些编译器并不保存转换后的程序文件。这种编译器常见于解释器内部

大多数Java虚拟机为了提高性能，会在执行过程中通过编译器将一部分Java二进制代码直接转换为机器语言使用。执行过程中进行的机器语言转换称为动态编译或JIT编译Just-In-Time compile。转换后得到的机器语言程序将被载入内存，由硬件执行，无需使用解释器

如果使用Eclipse开发Java程序，开发者很难看到编译过程。Eclipse其实已经把编译器与编辑器整合了，编译器会在开发者书写代码的同时执行编译，就好像编译始终能即时完成

过去人们提到的编译器时，首先会联想到费时的编译过程。不过由于编译后实际执行的是机器语言，因此执行速度很快。而对于解释器，人们通常会认为他会在程序输入的同时立即执行，执行速度比较慢。这就是两者的基本区别。现代的解释器内部常采用各种类型的编译器，已经越来越没有必要将解释器与编译器区分看待

本书将为极为简单的脚本语言开发语言处理器。本书开发的语言处理器属于解释器，不过，该解释器内部将采用编译器来提高性能，因此本书也将涉及开发编译器的一些基本知识。本书不包含代码优化之类的技巧，因此不会介绍诸如编译器在讲程序转换为机器语言时，如何提高机器语言的执行效率等内容

本书将设计的语言命名为Stone语言，实现该语言的开发语言是Java语言。因此，Stone语言也是一种运行于Java虚拟机的语言

Stone运行于Java虚拟机，并不轻巧。用Java语言以面向对象的方式设计语言处理器，语言处理器的复杂度适中，常用于实验或论证各种语言范型的性能

例如，Haskell语言或OCaml语言之类的函数型远，非常适合开发语言处理器。面向对象语言也是如此。本书在讲解时，默认读者十分了解面向对象语言，尤其是Java语言的基本编程方式

> 用C语言和yacc来实现的话如何？
>
> C语言本身没什么不好，但要实现稍微复杂些的语言处理器时，就不得不使用各种不同的编程技术。最终写出的C语言程序会具有面向对象风格，那还不如从最开始就使用面向对象语言

无论是解释器还是编译器，语言处理器前半部分的程序结构都大同小异

词法分析 语法分析 抽象语法树 至此，解释器于编译器的处理方式相同。之后，编译器将会把抽象语法树转换为其他语言，而解释器将会一边分析抽象语法树一边执行运算